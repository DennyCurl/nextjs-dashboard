#!/bin/bash

echo "üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ visits"
echo "=============================================="

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ —Å–µ—Ä–≤–µ—Ä–∞
if ! curl -s http://localhost:3001 > /dev/null 2>&1; then
    echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ localhost:3001"
    echo "–ó–∞–ø—É—Å—Ç—ñ—Ç—å 'npm run dev' –ø–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Ü—å–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞"
    exit 1
fi

echo "‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏–π"
echo "üöÄ –í–∏–∫–ª–∏–∫–∞—î–º–æ API –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ..."

response=$(curl -s -X POST http://localhost:3001/api/fix-visits-sequence)

if [ $? -eq 0 ]; then
    echo "üìÑ –í—ñ–¥–ø–æ–≤—ñ–¥—å API:"
    echo "$response" | head -c 300
    echo ""
    echo "‚úÖ –û–ø–µ—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
else
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É API"
fi

echo ""
echo "üí° –¢–µ–ø–µ—Ä —Å–ø—Ä–æ–±—É–π—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –æ–≥–ª—è–¥ –ø–∞—Ü—ñ—î–Ω—Ç–∞"